dist: trusty
sudo: false
language: c

env:
  global:
    - secure: "DlGKUj4+bSLXtULE7FGhJ94JxFZ0iqFftDgt/X8OIt7EHGTItHa1araoY5hqLMQmjHfL5wfCpzy4RqwfNofrT0lPLLY2JD2itFq2TgHoVCdq2PB+gbJswtu116zhPmd28Ks8F0LJ2pNI2kwmAdRNLTXK0WAFIiXktWUtUm1/EP4="
    - secure: "X0BWnBAjxck+oDcD2J6TvoXMJAS7EUkdr4uQS9ENUCQrYhB3qGSqinxmquf+621pRKoQDLBQakSTthmGfs62Oiaf+u8RCSyQq4PanqS1pqxfMQUQkQ2zrVo4YfTgFD2jYnHDddQfAXFjm8QxqSKqRggUGnaXBzLSUtV4YB+uXctOFXYDo6e0fxB3Y5NnG1/rvryqmImuWtqa8QWptr0wv+ZcmaLalL5yzMZY3IK618Vf6ovFNzqeYf8P2YFZK3i/IHHdkRDIkkf/Zx0qaj60CTWAi7txm6VeN389bZboE7ZwCaD3ALcaYYW5OyKA5w9e3fiTWpHuwKeZ/S9q/nT93Vt3Jm0QCGlH8QpaOOsFa6Sv10kJmNBuS8D55i6X+TuNRlmpxrrVhGXzPGpBlzTI6M0+A39Y9i6knUmWID8pE/l2Rv9XQGNMTGO1Nd/1VfaTN6vETs0y0EBfO0ynpVAt5Z6i+AXF9qt1+IcX68VHiaQoznA6PaQzJVcdS4AhFfn6K0AT6/GDeAqrqhoMuMr43D/HQcJxFB/fXRIymv5tgbzxtfubGDer5vq+MZqQsAv7/wi77R1iHJhtn0/S3vQ3vLTdzBi+3j3G2rVDlAqyV2pdEebQ9vF3HpmMYJHClnSFsfwVv1FNVAJj4V66zpukq2zuTlsGQXaNDxo2J/eEPpE="

matrix:
  include:

    # default linux build with gcc
    - os: linux
      env:
        - TEST="linux gcc"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
          - gcc-6
      script:
        - ./configure
        - make
        - make runtest

    # linux build with openssl and gcc
    - os: linux
      env:
        - TEST="linux gcc (openssl)"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
      script:
        - ./configure --enable-openssl
        - make
        - make runtest

    # linux build with openssl and clang
    - os: linux
      env:
        - TEST="linux clang (openssl)"
      addons:
        apt:
          packages:
            - clang
      script:
        - CC=clang ./configure --enable-openssl
        - make
        - make runtest

    # default osx build with xcode (clang)
    - os: osx
      env:
        - TEST="osx XCode 8.2"
      osx_image: xcode8.2
      script:
        - ./configure
        - make
        - make runtest

    # code format check
    - os: linux
      env:
        - TEST="clang-format"
      addons:
        apt:
          packages:
            - clang-format-3.9
      script:
        - ./format.sh -d

    # valgrind
    - os: linux
      env:
        - TEST="valgrind (openssl)"
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - valgrind
      script:
        - ./configure --enable-openssl
        - make
        - make runtest-valgrind

    # coverity scan
    - os: linux
      env:
        - TEST="Coverity Scan"
      addons:
        coverity_scan:
          project:
            name: "cisco-libSRTP"
            description: "Build submitted via Travis CI"
            notification_email: pabuhler@cisco.com
            version: 2
          build_command_prepend: "./configure"
          build_command: "make"
          branch_pattern: coverity-scan-2
      script:
        - echo -n | openssl s_client -connect scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-
